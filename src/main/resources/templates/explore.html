<!DOCTYPE html>
<html>
    <head>
        <title>Explore Page</title>
        <link th:href="@{/styles/explore.css}"
        rel="stylesheet">
    </head>
    <body onload="convert()">

    <!--Header-->
    <header>
        <img class="logo"
            height="100"
            alt="Logo"
            src="./images/logo.png"
            title="Logo">
        <nav class="nav">
            <input type="text" placeholder="Search for a park..." id="search" name="search">
            <button type="submit" onclick="searchParks()">Search</button>
            <a th:href="@{/home}">Home</a>&emsp;
            <a th:href="@{/register}">Sign Up</a>&emsp;
            <a>Add a Park</a>
        </nav>
    </header>

    <div class="top-section">
    <h1 class="h1">
        Explore All of Cardiff's Parks
    </h1>
    </div>

    <div id="parks-list"></div>
    <button onclick="sortRatingH2L()">Sort highest to lowest rating</button>
    <button onclick="sortRatingL2H()">Sort lowest to highest rating</button>
    <button onclick="filterParking()">View parks with parking</button>
    <button onclick="filterDogs()">View dog-friendly parks</button>
    <button onclick="filterKids()">View kid-friendly parks</button>

        <script>
            let jsonData = [
                {
                    "Name": "Nitesh Park",
                    "Location": "Roath",
                    "Rating": 4.8,
                    "Amenities": ["Gym", " Cafe", " Picnic Area"],
                    "Parking": true,
                    "Dogs": true,
                    "Kids":false
                },
                {
                    "Name": "Ian Park",
                    "Location": "Cathays",
                    "Rating": 4.7,
                    "Amenities": ["Garden", " Cafe", " Lake"],
                    "Parking": true,
                    "Dogs": true,
                    "Kids":false
                },
                {
                    "Name": "Louise Park",
                    "Location": "Pontcanna",
                    "Rating": 4.4,
                    "Amenities": ["Playground", " Garden", " Picnic Area"],
                    "Parking": false,
                    "Dogs": true,
                    "Kids":true
                }
            ];
            //Function to convert JSON data to HTML table
            function convert() {
                let container = document.getElementById("parks-list");
                let table = document.createElement("table");
                let cols = Object.keys(jsonData[0]).filter(col => col !== "Parking" && col !== "Kids" && col !== "Dogs");
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                cols.forEach((item) => {
                    let th = document.createElement("th");
                    th.innerText = item;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.append(thead);
                jsonData.forEach((item) => {
                    let tr = document.createElement("tr");
                    cols.forEach(col => {
                        let td = document.createElement("td");
                        td.innerText = Array.isArray(item[col]) ? item[col].join(", ") : item[col];
                        tr.appendChild(td);
                    });
                    table.appendChild(tr);
                });
                container.innerHTML = "";
                container.appendChild(table);
            }

            // Function to sort the parks from highest to lowest rating
            function sortRatingH2L() {
                jsonData.sort((a, b) => b.Rating - a.Rating);
                const container = document.getElementById("parks-list");
                container.innerHTML = "";
                convert();
            }

            // Function to sort the parks from lowest to highest rating
            function sortRatingL2H() {
                jsonData.sort((a, b) => a.Rating - b.Rating);
                const container = document.getElementById("parks-list");
                container.innerHTML = "";
                convert();
            }

            // Function to filter parks where parking is available
            function filterParking() {
                let container = document.getElementById("parks-list");
                let table = document.createElement("table");
                let cols = Object.keys(jsonData[0]).filter(col => col !== "Parking" && col !== "Kids" && col !== "Dogs");
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                cols.forEach((item) => {
                    let th = document.createElement("th");
                    th.innerText = item;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.append(thead);
                jsonData.forEach((item) => {
                    if (item.Parking) {
                        let tr = document.createElement("tr");
                        cols.forEach(col => {
                            let td = document.createElement("td");
                            td.innerText = Array.isArray(item[col]) ? item[col].join(", ") : item[col];
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    }
                });

                container.innerHTML = "";
                container.appendChild(table);
            }

            // Function to filter dog-friendly parks
            function filterDogs() {
                let container = document.getElementById("parks-list");
                let table = document.createElement("table");
                let cols = Object.keys(jsonData[0]).filter(col => col !== "Parking" && col !== "Kids" && col !== "Dogs");
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                cols.forEach((item) => {
                    let th = document.createElement("th");
                    th.innerText = item;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.append(thead);
                jsonData.forEach((item) => {
                    if (item.Dogs) {
                        let tr = document.createElement("tr");
                        cols.forEach(col => {
                            let td = document.createElement("td");
                            td.innerText = Array.isArray(item[col]) ? item[col].join(", ") : item[col];
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    }
                });

                container.innerHTML = "";
                container.appendChild(table);
            }

            // Function to filter kid-friendly parks
            function filterKids() {
                let container = document.getElementById("parks-list");
                let table = document.createElement("table");
                let cols = Object.keys(jsonData[0]).filter(col => col !== "Parking" && col !== "Kids" && col !== "Dogs");
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                cols.forEach((item) => {
                    let th = document.createElement("th");
                    th.innerText = item;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.append(thead);
                jsonData.forEach((item) => {
                    if (item.Kids) {
                        let tr = document.createElement("tr");
                        cols.forEach(col => {
                            let td = document.createElement("td");
                            td.innerText = Array.isArray(item[col]) ? item[col].join(", ") : item[col];
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    }
                });

                container.innerHTML = "";
                container.appendChild(table);
            }

            function searchParks() {
                let query = document.getElementById("search").value.toLowerCase();
                let container = document.getElementById("parks-list");
                let table = document.createElement("table");
                let cols = Object.keys(jsonData[0]).filter(col => col !== "Parking" && col !== "Kids" && col !== "Dogs");

                // Clear any existing "No park found" message
                container.innerHTML = "";

                // Create table header
                let thead = document.createElement("thead");
                let tr = document.createElement("tr");
                cols.forEach((item) => {
                    let th = document.createElement("th");
                    th.innerText = item;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.append(thead);

                // Filter parks based on query
                let filteredParks = jsonData.filter(park =>
                    park.Name.toLowerCase().includes(query) ||
                    park.Location.toLowerCase().includes(query)
                );

                // Populate table rows with filtered parks
                if (filteredParks.length > 0) {
                    filteredParks.forEach((item) => {
                        let tr = document.createElement("tr");
                        cols.forEach(col => {
                            let td = document.createElement("td");
                            td.innerText = Array.isArray(item[col]) ? item[col].join(", ") : item[col];
                            tr.appendChild(td);
                        });
                        table.appendChild(tr);
                    });
                    container.appendChild(table); // Append the table if parks are found
                } else {
                    // Display "No park found" message
                    let noResultMessage = document.createElement("p");
                    noResultMessage.innerText = "No park found.";
                    container.appendChild(noResultMessage);
                }
            }

        </script>

<!--Footer-->

    <footer class="footer">
        <h3>About Green Spaces</h3>
        <p>We're a group of outdoor enthusiasts, environmentalists,
            and city explorers passionate about green spaces!
            With backgrounds in ecology, design, and tech, we are committed
            to helping people find their next favorite park and meet like-minded park enthusiasts.
            Each review blends expert insights and real experiences to make every visit memorable.</p><br>
            <em><a href="/src/main/resources/static/register.html">Sign up </a>today to join our community!</em>
            <br>
        <a href="">Terms of Service</a><br>
        <a href="">Privacy Policy</a>
    </footer>
    </body>
</html>